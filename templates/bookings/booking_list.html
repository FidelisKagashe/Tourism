{% extends 'base/base.html' %}
{% load i18n %}

{% block title %}{% trans "My Bookings" %} - {{ site_settings.site_name|default:"Safari & Bush Retreats" }}{% endblock %}

{% block extra_css %}
<style>
/* Typography scale copied from other templates â€” affects only font-size & line-height for consistent headings */
:root{
  --fs-xxl: clamp(1.6rem, 4.0vw, 3.2rem);
  --fs-xl:  clamp(1.25rem, 2.6vw, 2.25rem);
  --fs-lg:  clamp(1.05rem, 1.9vw, 1.5rem);
  --fs-base:clamp(0.95rem, 1.0vw, 1.06rem);
  --fs-sm:  clamp(0.82rem, 0.8vw, 0.95rem);
  --lh-tight: 1.08;
  --lh-heading: 1.15;
  --lh-base: 1.42;
}
html { font-size: 16px; }
body { font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; font-size: var(--fs-base) !important; line-height: var(--lh-base) !important; }
h1 { font-size: var(--fs-xxl) !important; line-height: var(--lh-tight) !important; font-weight: 600 !important; }
h2 { font-size: var(--fs-xl) !important; line-height: var(--lh-heading) !important; font-weight: 600 !important; }
h3 { font-size: var(--fs-lg) !important; line-height: var(--lh-heading) !important; font-weight: 600 !important; }
p, .text-base { font-size: var(--fs-base) !important; line-height: var(--lh-base) !important; }
small, .text-muted { font-size: var(--fs-sm) !important; }

/* Desktop scaling for stronger headings */
@media (min-width: 1024px) {
  :root{
    --fs-xxl: clamp(2.25rem, 2.6vw, 3.5rem);
    --fs-xl:  clamp(1.5rem, 1.8vw, 2.25rem);
    --fs-lg:  clamp(1.125rem, 1.4vw, 1.5rem);
    --fs-base:clamp(1.0rem, 1.0vw, 1.125rem);
    --fs-sm:  clamp(0.88rem, 0.8vw, 0.98rem);
  }
  h1 { font-size: var(--fs-xxl) !important; }
  h2 { font-size: var(--fs-xl) !important; }
  h3 { font-size: var(--fs-lg) !important; }
}

/* Specific: target the bookings page header which used Tailwind classes (text-3xl). 
   This selector is intentionally specific and uses !important so it overrides utility classes. */
.container .bookings-page-title, .container h1.bookings-page-title, .page-bookings .bookings-page-title {
  font-size: clamp(1.6rem, 3.2vw, 2.6rem) !important;
  line-height: 1.06 !important;
  font-weight: 700 !important;
}
@media (min-width: 1024px) {
  .container .bookings-page-title, .page-bookings .bookings-page-title {
    font-size: clamp(1.9rem, 2.4vw, 3.1rem) !important;
    line-height: 1.04 !important;
  }
}

/* Also slightly increase the subtitle under the heading */
.container .bookings-subtitle { font-size: clamp(0.95rem, 1.1vw, 1.12rem) !important; color: #6b7280 !important; }

/* Make sure card titles remain compact */
.booking-card h6, .card h6 { font-size: var(--fs-lg) !important; }

</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-5 page-bookings">
  <div class="flex flex-col">
    <div class="w-full">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
        <div class="mb-4 md:mb-0">
          <!-- added bookings-page-title class -->
          <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100 bookings-page-title">{% trans "My Bookings" %}</h1>
          <p class="text-gray-500 dark:text-gray-300 mt-1 bookings-subtitle">{% trans "Manage your safari bookings" %}</p>
        </div>

        <div>
          <a href="{% url 'tours:tour_list' %}"
             class="bg-[#C18D45] hover:bg-[#a5793a] text-white font-medium py-2 px-4 rounded-md flex items-center transition duration-300">
            <i class="fas fa-plus mr-2"></i>{% trans "Book New Tour" %}
          </a>
        </div>
      </div>
    </div>
  </div>

  {% if bookings %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% for booking in bookings %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 booking-card">
          <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
            <h6 class="font-semibold text-gray-700 dark:text-gray-100">{{ booking.booking_reference }}</h6>
            <span class="px-3 py-1 rounded-full text-xs font-semibold
              {% if booking.booking_status == 'confirmed' %}bg-green-500 text-white
              {% elif booking.booking_status == 'pending' %}bg-[#C18D45] text-white
              {% elif booking.booking_status == 'cancelled' %}bg-gray-500 text-white
              {% else %}bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200{% endif %}">
              {{ booking.get_booking_status_display }}
            </span>
          </div>

          <div class="p-4">
            <div class="flex mb-4">
              <img src="{% if booking.tour_package.main_image %}{{ booking.tour_package.main_image.url }}{% else %}https://images.pexels.com/photos/1170986/pexels-photo-1170986.jpeg{% endif %}"
                   class="rounded-lg w-20 h-20 object-cover mr-3" alt="{{ booking.tour_package.title }}">
              <div class="flex-1">
                <h6 class="font-bold text-gray-800 dark:text-gray-100">{{ booking.tour_package.title }}</h6>
                <p class="text-gray-500 dark:text-gray-300 text-sm mt-1"><i class="fas fa-users mr-1"></i>{{ booking.number_of_participants }} {% trans "participants" %}</p>
                <p class="text-gray-500 dark:text-gray-300 text-sm"><i class="fas fa-calendar mr-1"></i>{{ booking.created_at|date:"M d, Y" }}</p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-gray-500 dark:text-gray-300 text-sm">{% trans "Total Price" %}</p>
                <div class="text-green-500 font-bold text-xl">${{ booking.total_price|floatformat:2 }}</div>
              </div>

              <div>
                <p class="text-gray-500 dark:text-gray-300 text-sm">{% trans "Payment Status" %}</p>
                <span class="px-3 py-1 rounded-full text-xs font-semibold
                  {% if booking.payment_status == 'paid' %}bg-green-500 text-white
                  {% elif booking.payment_status == 'pending' %}bg-[#C18D45] text-white
                  {% elif booking.payment_status == 'failed' %}bg-gray-500 text-white
                  {% else %}bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200{% endif %}">
                  {{ booking.get_payment_status_display }}
                </span>
              </div>
            </div>

            <div class="space-y-2">
              <a href="{% url 'bookings:booking_detail' booking.booking_reference %}"
                 class="block bg-green-500 hover:bg-green-600 text-white text-center font-medium py-2 px-4 rounded-md transition duration-300">
                {% trans "View Details" %}
              </a>

              {% if booking.booking_status == 'pending' and booking.payment_status == 'pending' %}
                <a href="{% url 'bookings:booking_payment' booking.booking_reference %}"
                   class="block bg-[#C18D45] hover:bg-[#a5793a] text-white text-center font-medium py-2 px-4 rounded-md transition duration-300">
                  {% trans "Complete Payment" %}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if bookings.has_other_pages %}
      <nav class="mt-8">
        <ul class="flex justify-center space-x-2">
          {% if bookings.has_previous %}
            <li>
              <a href="?page={{ bookings.previous_page_number }}"
                 class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition duration-200">
                {% trans "Previous" %}
              </a>
            </li>
          {% endif %}

          {% for num in bookings.paginator.page_range %}
            {% if bookings.number == num %}
              <li><span class="px-4 py-2 bg-[#C18D45] text-white rounded-md">{{ num }}</span></li>
            {% elif num > bookings.number|add:'-3' and num < bookings.number|add:'3' %}
              <li>
                <a href="?page={{ num }}"
                   class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition duration-200">
                  {{ num }}
                </a>
              </li>
            {% endif %}
          {% endfor %}

          {% if bookings.has_next %}
            <li>
              <a href="?page={{ bookings.next_page_number }}"
                 class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition duration-200">
                {% trans "Next" %}
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}

  {% else %}
    <div class="text-center py-12">
      <i class="fas fa-calendar-times text-5xl text-gray-300 dark:text-gray-500 mb-4"></i>
      <h3 class="text-2xl font-semibold text-gray-700 dark:text-gray-100 mb-2">{% trans "No bookings yet" %}</h3>
      <p class="text-gray-500 dark:text-gray-300 mb-6">{% trans "Start planning your next adventure!" %}</p>
      <a href="{% url 'tours:tour_list' %}" class="inline-block bg-[#C18D45] hover:bg-[#a5793a] text-white font-medium py-3 px-6 rounded-md transition duration-300">
        <i class="fas fa-binoculars mr-2"></i>{% trans "Browse Tours" %}
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
