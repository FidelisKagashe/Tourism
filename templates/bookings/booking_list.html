{% extends 'base/base.html' %}
{% load i18n %}

{% block title %}{% trans "My Bookings" %} - Safari&nbsp;&amp;&nbsp;Bush Retreats{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-5">
  <div class="flex flex-col">
    <div class="w-full">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
        <div class="mb-4 md:mb-0">
          <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">{% trans "My Bookings" %}</h1>
          <p class="text-gray-500 dark:text-gray-300 mt-1">{% trans "Manage your safari bookings" %}</p>
        </div>

        <div>
          <a href="{% url 'tours:tour_list' %}"
             class="bg-[#C18D45] hover:bg-[#a5793a] text-white font-medium py-2 px-4 rounded-md flex items-center transition duration-300">
            <i class="fas fa-plus mr-2"></i>{% trans "Book New Tour" %}
          </a>
        </div>
      </div>
    </div>
  </div>

  {% if bookings %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% for booking in bookings %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-200 dark:border-gray-700">
          <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
            <h6 class="font-semibold text-gray-700 dark:text-gray-100">{{ booking.booking_reference }}</h6>
            <span class="px-3 py-1 rounded-full text-xs font-semibold
              {% if booking.booking_status == 'confirmed' %}bg-green-500 text-white
              {% elif booking.booking_status == 'pending' %}bg-[#C18D45] text-white
              {% elif booking.booking_status == 'cancelled' %}bg-gray-500 text-white
              {% else %}bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200{% endif %}">
              {{ booking.get_booking_status_display }}
            </span>
          </div>

          <div class="p-4">
            <div class="flex mb-4">
              <img src="{% if booking.tour_package.main_image %}{{ booking.tour_package.main_image.url }}{% else %}https://images.pexels.com/photos/1170986/pexels-photo-1170986.jpeg{% endif %}"
                   class="rounded-lg w-20 h-20 object-cover mr-3" alt="{{ booking.tour_package.title }}">
              <div class="flex-1">
                <h6 class="font-bold text-gray-800 dark:text-gray-100">{{ booking.tour_package.title }}</h6>
                <p class="text-gray-500 dark:text-gray-300 text-sm mt-1"><i class="fas fa-users mr-1"></i>{{ booking.number_of_participants }} {% trans "participants" %}</p>
                <p class="text-gray-500 dark:text-gray-300 text-sm"><i class="fas fa-calendar mr-1"></i>{{ booking.created_at|date:"M d, Y" }}</p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-gray-500 dark:text-gray-300 text-sm">{% trans "Total Price" %}</p>
                <div class="text-green-500 font-bold text-xl">${{ booking.total_price|floatformat:2 }}</div>
              </div>

              <div>
                <p class="text-gray-500 dark:text-gray-300 text-sm">{% trans "Payment Status" %}</p>
                <span class="px-3 py-1 rounded-full text-xs font-semibold
                  {% if booking.payment_status == 'paid' %}bg-green-500 text-white
                  {% elif booking.payment_status == 'pending' %}bg-[#C18D45] text-white
                  {% elif booking.payment_status == 'failed' %}bg-gray-500 text-white
                  {% else %}bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200{% endif %}">
                  {{ booking.get_payment_status_display }}
                </span>
              </div>
            </div>

            <div class="space-y-2">
              <a href="{% url 'bookings:booking_detail' booking.booking_reference %}"
                 class="block bg-green-500 hover:bg-green-600 text-white text-center font-medium py-2 px-4 rounded-md transition duration-300">
                {% trans "View Details" %}
              </a>

              {% if booking.booking_status == 'pending' and booking.payment_status == 'pending' %}
                <a href="{% url 'bookings:booking_payment' booking.booking_reference %}"
                   class="block bg-[#C18D45] hover:bg-[#a5793a] text-white text-center font-medium py-2 px-4 rounded-md transition duration-300">
                  {% trans "Complete Payment" %}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if bookings.has_other_pages %}
      <nav class="mt-8">
        <ul class="flex justify-center space-x-2">
          {% if bookings.has_previous %}
            <li>
              <a href="?page={{ bookings.previous_page_number }}"
                 class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition duration-200">
                {% trans "Previous" %}
              </a>
            </li>
          {% endif %}

          {% for num in bookings.paginator.page_range %}
            {% if bookings.number == num %}
              <li><span class="px-4 py-2 bg-[#C18D45] text-white rounded-md">{{ num }}</span></li>
            {% elif num > bookings.number|add:'-3' and num < bookings.number|add:'3' %}
              <li>
                <a href="?page={{ num }}"
                   class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition duration-200">
                  {{ num }}
                </a>
              </li>
            {% endif %}
          {% endfor %}

          {% if bookings.has_next %}
            <li>
              <a href="?page={{ bookings.next_page_number }}"
                 class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition duration-200">
                {% trans "Next" %}
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}

  {% else %}
    <div class="text-center py-12">
      <i class="fas fa-calendar-times text-5xl text-gray-300 dark:text-gray-500 mb-4"></i>
      <h3 class="text-2xl font-semibold text-gray-700 dark:text-gray-100 mb-2">{% trans "No bookings yet" %}</h3>
      <p class="text-gray-500 dark:text-gray-300 mb-6">{% trans "Start planning your next adventure!" %}</p>
      <a href="{% url 'tours:tour_list' %}" class="inline-block bg-[#C18D45] hover:bg-[#a5793a] text-white font-medium py-3 px-6 rounded-md transition duration-300">
        <i class="fas fa-binoculars mr-2"></i>{% trans "Browse Tours" %}
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
