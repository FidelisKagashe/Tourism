{% extends 'base/base.html' %}

{% block title %}Welcome to {{ site_settings.site_name|default:"Safari & Bush Retreats" }} - Discover Wildlife & National Parks{% endblock %}

{% block extra_css %}
<style>
    /* (kept your custom CSS for hero, cards, animations, etc.) */
    :root {
        /* light theme values (match Tailwind config in base.html) */
        --primary-color: #C18D45;
        --primary-rgb: 193,141,69;
        --primary-dark-color: #E4B366; /* fallback reference */
        --secondary-color: #715F3C;
        --secondary-rgb: 113,95,60;
        --card-bg: #ffffff;
        --bg-body: #f8fafc;
        --light-color: #ffffff;
        --text-white: #ffffff;
        --text-primary: #111827; /* gray-900 */
        --accent-color: #FFD89B;
        --border-color: rgba(0,0,0,0.06);
    }

    /* dark theme overrides (activated when .dark is present on <html>) */
    .dark :root,
    :root.dark {
        --primary-color: #E4B366;
        --primary-rgb: 228,179,102;
        --secondary-color: #B8986F;
        --secondary-rgb: 184,152,111;
        --card-bg: #374151;       /* gray-700 */
        --bg-body: #0f172a;       /* gray-900 */
        --light-color: #111827;   /* gray-900 */
        --text-primary: #f3f4f6;  /* gray-100 */
        --border-color: rgba(255,255,255,0.06);
    }

    /* Enhanced Hero Section */
    .hero-section {
        background: linear-gradient(135deg, rgba(0,0,0,0.5), rgba(var(--primary-rgb),0.3)), url('https://images.pexels.com/photos/631317/pexels-photo-631317.jpeg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        min-height: 80vh;
        display: flex;
        align-items: center;
        color: var(--text-white);
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(var(--primary-rgb),0.08), rgba(var(--secondary-rgb),0.08));
        animation: heroOverlay 20s ease-in-out infinite;
    }

    @keyframes heroOverlay {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.6; }
    }

    .hero-section .container {
        position: relative;
        z-index: 2;
    }

    .hero-section h1 {
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        animation: fadeInUp 1s ease-out;
    }

    .hero-section p {
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        animation: fadeInUp 1s ease-out 0.3s both;
    }

    .hero-section .btn {
        animation: fadeInUp 1s ease-out 0.6s both;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
    }

    .hero-section .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Enhanced Stats Section */
    .stats-section {
        background: linear-gradient(135deg, var(--bg-body), var(--light-color));
        position: relative;
    }

    .stats-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }

    .stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(var(--primary-rgb),0.1), transparent);
        transition: left 0.6s ease;
    }

    .stats-card:hover::before {
        left: 100%;
    }

    .stats-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        border-color: var(--primary-color);
    }

    .stats-card i {
        transition: all 0.3s ease;
    }

    .stats-card:hover i {
        transform: scale(1.2) rotate(5deg);
        color: var(--primary-color);
    }

    .stats-card h3 {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 1rem 0 0.5rem;
        transition: all 0.3s ease;
    }

    .stats-card:hover h3 {
        transform: scale(1.1);
    }

    /* Enhanced Card Designs (kept) */
    .feature-card {
        border: none;
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        background: var(--card-bg);
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        position: relative;
    }

    .feature-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .feature-card:hover::before {
        transform: scaleX(1);
    }

    .feature-card:hover {
        transform: translateY(-15px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }

    .feature-card .card-img-top {
        transition: all 0.4s ease;
        position: relative;
    }

    .feature-card:hover .card-img-top {
        transform: scale(1.05);
    }

    .feature-card .badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(var(--primary-rgb),0.9);
        backdrop-filter: blur(10px);
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-weight: 500;
        color: var(--text-white);
    }

    /* Tour, review, newsletter styles kept (unchanged) */
    .tour-card {
        border: none;
        border-radius: 20px;
        overflow: hidden;
        background: var(--card-bg);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        transition: all 0.4s ease;
        position: relative;
    }

    .tour-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(var(--primary-rgb),0.05), rgba(var(--secondary-rgb),0.05));
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
    }

    .tour-card:hover::after { opacity: 1; }
    .tour-card:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(0,0,0,0.15); }
    .tour-card img { transition: all 0.4s ease; height: 300px; object-fit: cover; }
    .tour-card:hover img { transform: scale(1.03); }

    .review-card { border: none; border-radius: 15px; background: var(--card-bg); box-shadow: 0 5px 20px rgba(0,0,0,0.08); transition: all 0.3s ease; position: relative; overflow: hidden; }
    .review-card::before { content: '"'; position: absolute; top: -10px; left: 20px; font-size: 4rem; color: var(--primary-color); opacity: 0.1; font-family: serif; }
    .review-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
    .review-avatar { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; transition: all 0.3s ease; }
    .review-card:hover .review-avatar { transform: scale(1.1) rotate(5deg); }

    .newsletter-section { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); position: relative; overflow: hidden; }
    .newsletter-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="10" cy="90" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>'); opacity: 0.3; }
    .newsletter-section .container { position: relative; z-index: 2; }
    .newsletter-input-group { max-width: 500px; margin: 0 auto; position: relative; }
    .newsletter-input-group .form-control { border: none; border-radius: 50px; padding: 1rem 1.5rem; font-size: 1.1rem; box-shadow: 0 5px 20px rgba(0,0,0,0.1); background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); }
    .newsletter-input-group .btn { border-radius: 50px; padding: 1rem 2rem; font-weight: 600; background: var(--text-white); color: var(--primary-color); border: none; transition: all 0.3s ease; }
    .newsletter-input-group .btn:hover { transform: translateX(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); background: var(--light-color); }

    /* Section Titles Enhancement */
    .section-title { position: relative; display: inline-block; margin-bottom: 3rem; font-weight: 700; color: var(--text-primary); }
    .section-title::after { content: ''; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); width: 80px; height: 4px; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); border-radius: 2px; }
    .section-title::before { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 40px; height: 4px; background: var(--accent-color); border-radius: 2px; }

    /* Enhanced Buttons */
    .btn-enhanced { position: relative; overflow: hidden; transition: all 0.3s ease; }
    .btn-enhanced::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease; }
    .btn-enhanced:hover::before { left: 100%; }

    /* Responsive Enhancements */
    @media (max-width: 768px) {
        .hero-section { min-height: 60vh; background-attachment: scroll; }
        .hero-section h1 { font-size: 2.5rem; }
        .stats-card { padding: 1.5rem; margin-bottom: 2rem; }
        .tour-card .row { flex-direction: column; }
        .tour-card img { height: 200px; }
        .newsletter-input-group { flex-direction: column; gap: 1rem; }
        .newsletter-input-group .btn { width: 100%; }
    }

    /* Loading Animation */
    .fade-in { opacity: 0; transform: translateY(30px); transition: all 0.6s ease; }
    .fade-in.visible { opacity: 1; transform: translateY(0); }

    /* Enhanced Star Rating */
    .star-rating { color: #ffc107; font-size: 1.1rem; }
    .star-rating i { transition: all 0.2s ease; }
    .star-rating:hover i { transform: scale(1.1); }

    /* Price Tag Enhancement */
    .price-tag {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 0.5rem 1.2rem;
        border-radius: 25px;
        font-weight: 600;
        font-size: 1.1rem;
        box-shadow: 0 3px 10px rgba(193,141,69,0.3);
        transition: all 0.3s ease;
    }
    .price-tag:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(193,141,69,0.4); }
    
</style>
{% endblock %}

{% block content %}
<!-- Enhanced Hero Section -->
<section class="hero-section">
    <div class="container max-w-7xl mx-auto px-4">
        <div class="flex items-center">
            <div class="w-full lg:w-2/3">
                <h1 class="text-3xl md:text-5xl font-extrabold leading-tight mb-4">Discover the Magic of Tanzania</h1>
                <p class="text-lg md:text-xl text-gray-100 mb-6">Experience breathtaking wildlife, stunning landscapes, and rich culture with our expertly guided safari tours across Tanzania's most spectacular national parks.</p>
                <div class="flex flex-wrap gap-3">
                    <a href="{% url 'tours:tour_list' %}" class="inline-flex items-center px-6 py-3 rounded-full bg-primary dark:bg-primary-dark text-white font-semibold btn-enhanced shadow hover:shadow-lg transition">
                        <i class="fas fa-binoculars mr-2"></i>Explore Tours
                    </a>
                    <a href="{% url 'parks:park_list' %}" class="inline-flex items-center px-6 py-3 rounded-full bg-white/20 text-white font-semibold border border-white/30 btn-enhanced hover:bg-white/30 transition">
                        <i class="fas fa-mountain mr-2"></i>National Parks
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Enhanced Quick Stats -->
<section class="py-12 stats-section">
    <div class="container max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 text-center">
            <div class="stats-card fade-in">
                <i class="fas fa-mountain text-4xl" style="color:var(--primary-color); margin-bottom:0.75rem;"></i>
                <h3 class="text-3xl font-bold">{{ stats.total_parks }}+</h3>
                <p class="text-sm" style="color:var(--text-primary);">National Parks</p>
            </div>

            <div class="stats-card fade-in">
                <i class="fas fa-route text-4xl" style="color:var(--primary-color); margin-bottom:0.75rem;"></i>
                <h3 class="text-3xl font-bold">{{ stats.total_tours }}+</h3>
                <p class="text-sm" style="color:var(--text-primary);">Safari Tours</p>
            </div>

            <div class="stats-card fade-in">
                <i class="fas fa-users text-4xl" style="color:var(--primary-color); margin-bottom:0.75rem;"></i>
                <h3 class="text-3xl font-bold">5000+</h3>
                <p class="text-sm" style="color:var(--text-primary);">Happy Travelers</p>
            </div>

            <div class="stats-card fade-in">
                <i class="fas fa-star text-4xl" style="color:var(--primary-color); margin-bottom:0.75rem;"></i>
                <h3 class="text-3xl font-bold">{{ stats.average_rating|floatformat:1 }}</h3>
                <p class="text-sm" style="color:var(--text-primary);">Average Rating</p>
            </div>
        </div>
    </div>
</section>

<!-- Enhanced Featured National Parks -->
<section class="py-12">
    <div class="container max-w-7xl mx-auto px-4">
        <div class="text-center mb-10">
            <h2 class="section-title text-2xl md:text-3xl">Featured National Parks</h2>
            <p class="text-gray-500">Explore Tanzania's most iconic wildlife destinations</p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for park in featured_parks %}
            <div class="feature-card fade-in">
                <div class="relative">
                    <img src="{% if park.main_image %}{{ park.main_image.url }}{% else %}https://images.pexels.com/photos/631317/pexels-photo-631317.jpeg{% endif %}" loading="lazy"
                         alt="{{ park.name }}" class="w-full h-64 object-cover">
                    <span class="absolute top-4 right-4 inline-block" style="background:var(--primary-color); color:var(--text-white); font-size:.875rem; padding:.25rem .75rem; border-radius:9999px;">
                        {{ park.get_park_type_display }}
                    </span>
                </div>
                <div class="p-6 flex flex-col h-full">
                    <h5 class="text-lg font-bold">{{ park.name }}</h5>
                    <p class="text-sm" style="color:var(--text-primary); margin-top:.5rem;">
                        <i class="fas fa-map-marker-alt mr-1" style="color:var(--primary-color)"></i>{{ park.location }}, {{ park.region }}
                    </p>
                    <p class="text-gray-700 mt-3 flex-grow" style="color:var(--text-primary)">{{ park.short_description }}</p>
                    <div class="flex items-center justify-between mt-4">
                        <small class="text-sm" style="color:var(--text-primary); font-weight:600;">{{ park.area_km2|floatformat:0 }} kmÂ²</small>
                        <a href="{% url 'parks:park_detail' park.slug %}" class="inline-flex items-center px-4 py-2 rounded-full" style="background:var(--primary-color); color:var(--text-white); font-size:.875rem;">
                            Explore Park
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-3 text-center">
                <div class="p-6 bg-blue-50 rounded-md">
                    <i class="fas fa-info-circle mr-2"></i>No featured parks available at the moment.
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-8">
            <a href="{% url 'parks:park_list' %}" class="inline-flex items-center px-6 py-3 rounded-full" style="border:1px solid var(--primary-color); color:var(--primary-color);">
                View All Parks <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- Enhanced Featured Tours -->
<section class="py-12 stats-section">
    <div class="container max-w-7xl mx-auto px-4">
        <div class="text-center mb-10">
            <h2 class="section-title text-2xl md:text-3xl">Featured Safari Tours</h2>
            <p class="text-gray-500">Handpicked adventures for unforgettable experiences</p>
        </div>

        <div class="space-y-6">
            {% for tour in featured_tours %}
            <article class="tour-card fade-in overflow-hidden">
                <div class="md:flex md:items-stretch">
                    <div class="md:w-1/2">
                        <img src="{% if tour.main_image %}{{ tour.main_image.url }}{% else %}https://images.pexels.com/photos/1170986/pexels-photo-1170986.jpeg{% endif %}" loading="lazy"
                             alt="{{ tour.title }}" class="w-full h-64 md:h-full object-cover">
                    </div>
                    <div class="md:w-1/2 p-6 flex flex-col">
                        <div class="flex justify-between items-start mb-3">
                            <span class="inline-block" style="background:var(--card-bg); color:var(--text-primary); padding:.25rem .75rem; border-radius:9999px; font-size:.875rem;">{{ tour.get_category_display }}</span>
                            <span class="inline-block" style="background:var(--primary-color); color:var(--text-white); padding:.25rem .75rem; border-radius:9999px; font-size:.875rem;">{{ tour.get_difficulty_level_display }}</span>
                        </div>

                        <h3 class="text-xl font-bold mb-2">{{ tour.title }}</h3>

                        <p class="text-sm" style="color:var(--text-primary); margin-bottom:.75rem;">
                            <i class="fas fa-clock mr-2"></i>{{ tour.get_duration_display }}
                            <span class="ml-4"><i class="fas fa-users mr-2"></i>{{ tour.min_participants }}-{{ tour.max_participants }} people</span>
                        </p>

                        <p class="text-gray-700 flex-grow mb-4" style="color:var(--text-primary);">{{ tour.short_description|truncatewords:15 }}</p>

                        <div class="flex items-center justify-between mt-auto">
                            <div class="star-rating flex items-center">
                                {% with rating=tour.average_rating|floatformat:0 %}
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= rating %}
                                            <i class="fas fa-star mr-1"></i>
                                        {% else %}
                                            <i class="far fa-star mr-1"></i>
                                        {% endif %}
                                    {% endfor %}
                                {% endwith %}
                                <small class="text-gray-500 ml-2" style="color:var(--text-primary);">({{ tour.total_reviews }} reviews)</small>
                            </div>

                            <a href="{% url 'tours:tour_detail' tour.slug %}" class="inline-flex items-center px-4 py-2 rounded-full" style="background:var(--primary-color); color:var(--text-white);">
                                View Details <i class="fas fa-arrow-right ml-2"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </article>
            {% empty %}
            <div class="text-center">
                <div class="p-6 bg-blue-50 rounded-md">
                    <i class="fas fa-info-circle mr-2"></i>No featured tours available at the moment.
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-8">
            <a href="{% url 'tours:tour_list' %}" class="inline-flex items-center px-6 py-3 rounded-full" style="border:1px solid var(--primary-color); color:var(--primary-color);">
                View All Tours <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- Enhanced Recent Reviews -->
<section class="py-12">
  <div class="container max-w-7xl mx-auto px-4">
    <div class="text-center mb-10">
      <h2 class="section-title text-2xl md:text-3xl text-gray-900 dark:text-gray-100">What Our Travelers Say</h2>
      <p class="text-gray-500 dark:text-gray-400">Real experiences from real adventurers</p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for review in recent_reviews %}
      <div class="review-card p-6 flex flex-col bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-200">
        <div class="flex items-center mb-4">
          <div class="review-avatar flex-shrink-0 w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
            <i class="fas fa-user text-gray-500 dark:text-gray-200" aria-hidden="true"></i>
          </div>
          <div class="flex-1 ml-3">
            <h6 class="font-bold text-gray-900 dark:text-gray-100">{{ review.user.get_display_name }}</h6>
            <div class="star-rating mt-1" aria-hidden="true">
              {% for i in "12345" %}
                {% if forloop.counter <= review.rating %}
                  <i class="fas fa-star mr-1 text-yellow-400 dark:text-yellow-300"></i>
                {% else %}
                  <i class="far fa-star mr-1 text-yellow-400/60 dark:text-yellow-300/60"></i>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>

        <h6 class="font-semibold mb-3 text-gray-800 dark:text-gray-100">{{ review.title }}</h6>
        <p class="text-gray-700 dark:text-gray-300 mb-4">{{ review.content|truncatewords:20 }}</p>

        <div class="mt-auto">
          <small class="text-gray-500 dark:text-gray-400 font-semibold flex items-center">
            <i class="fas fa-map-marker-alt mr-1 text-gray-500 dark:text-gray-400" aria-hidden="true"></i>
            {% if review.tour_package %}
              {{ review.tour_package.title }}
            {% elif review.national_park %}
              {{ review.national_park.name }}
            {% endif %}
          </small>
        </div>
      </div>
      {% empty %}
      <div class="col-span-3 text-center">
        <div class="p-6 bg-blue-50 dark:bg-blue-900 text-gray-700 dark:text-gray-100 rounded-md inline-block">
          <i class="fas fa-info-circle mr-2" aria-hidden="true"></i>No reviews available yet. Be the first to share your experience!
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="text-center mt-8">
      <a href="{% url 'reviews:review_list' %}"
         class="inline-flex items-center px-6 py-3 rounded-full border border-[#C18D45] text-[#C18D45] hover:bg-[#C18D45] hover:text-white transition-colors duration-200 dark:border-[#b7894a] dark:text-[#b7894a] dark:hover:bg-[#b7894a] dark:hover:text-white">
        Read All Reviews <i class="fas fa-arrow-right ml-2" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</section>

<!-- Enhanced Newsletter Signup -->
<section class="py-12 newsletter-section bg-[#0f1724] text-white dark:bg-gray-900">
  <div class="container max-w-7xl mx-auto px-4">
    <div class="md:flex md:items-center md:justify-between">
      <div class="md:w-1/2 mb-6 md:mb-0 text-center md:text-left">
        <h3 class="font-extrabold text-2xl md:text-3xl mb-2 text-white dark:text-white">Stay Updated with Our Adventures</h3>
        <p class="text-sm md:text-base mb-0 text-gray-100/90 dark:text-gray-300">
          Get the latest safari deals, travel tips, and wildlife updates delivered to your inbox.
        </p>
      </div>

      <div class="md:w-1/2">
        <div class="newsletter-input-group flex items-center justify-center md:justify-end gap-3">
          <input
            type="email"
            id="newsletter-email"
            class="rounded-full px-4 py-3 w-full md:w-80 bg-white text-gray-900 placeholder-gray-500 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#C18D45] focus:border-transparent dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 dark:focus:ring-[#C18D45]/80 transition"
            placeholder="Enter your email address"
            aria-label="Email address"
          />

          <button
            id="newsletter-submit"
            class="inline-flex items-center rounded-full px-5 py-3 font-semibold shadow-md bg-[#C18D45] hover:bg-[#a6783a] text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#C18D45]/60 dark:focus:ring-[#C18D45]/80"
            type="button"
            onclick="subscribeNewsletter()"
          >
            <i class="fas fa-paper-plane mr-2" aria-hidden="true"></i>
            Subscribe
          </button>
        </div>

        <!-- screen-reader live status for announcements -->
        <div id="newsletter-status" class="sr-only" role="status" aria-live="polite"></div>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Intersection Observer for fade-in animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
        });
    }, observerOptions);
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

    // Helper to get cookie (for CSRF)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            document.cookie.split(';').forEach(c => {
                const cookie = c.trim();
                if (cookie.startsWith(name + '=')) cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            });
        }
        return cookieValue;
    }

    // Improved newsletter subscription function
    window.subscribeNewsletter = function() {
        const emailInput = document.getElementById('newsletter-email');
        const button = document.getElementById('newsletter-submit');
        const statusEl = document.getElementById('newsletter-status');
        const email = emailInput.value.trim();

        // reset status for screen readers
        statusEl.textContent = '';

        if (!email) {
            emailInput.classList.add('is-invalid');
            emailInput.setAttribute('aria-invalid', 'true');
            emailInput.focus();
            statusEl.textContent = 'Please enter your email address.';
            return;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            emailInput.classList.add('is-invalid');
            emailInput.setAttribute('aria-invalid', 'true');
            emailInput.focus();
            statusEl.textContent = 'Please enter a valid email address.';
            return;
        }

        emailInput.classList.remove('is-invalid');
        emailInput.removeAttribute('aria-invalid');

        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Subscribing...';
        button.disabled = true;

        const csrftoken = getCookie('csrftoken');

        fetch('{% url "core:newsletter_signup" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrftoken
            },
            body: new URLSearchParams({ email })
        })
        .then(response => {
            if (!response.ok) return response.json().then(j => { throw j; });
            return response.json();
        })
        .then(data => {
            if (data.success) {
                emailInput.value = '';
                emailInput.classList.add('is-valid');
                statusEl.textContent = 'Subscribed successfully!';
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Subscribed!';
                button.classList.add('bg-green-500', 'text-white');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-500', 'text-white');
                    button.disabled = false;
                    emailInput.classList.remove('is-valid');
                    statusEl.textContent = '';
                }, 3000);
            } else {
                throw new Error(data.message || 'Subscription failed');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            statusEl.textContent = error.message || 'Subscription failed. Please try again.';
            button.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Try Again';
            button.classList.add('bg-yellow-400');
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('bg-yellow-400');
                button.disabled = false;
                statusEl.textContent = '';
            }, 3000);
        });
    };

    // keyboard submit
    const newsletterInput = document.getElementById('newsletter-email');
    if (newsletterInput) {
        newsletterInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') subscribeNewsletter();
        });
        newsletterInput.addEventListener('input', function() {
            this.classList.remove('is-invalid', 'is-valid');
        });
    }
});
</script>
{% endblock %}
